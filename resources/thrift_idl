namespace java util.thrift


enum RequestType {
    UNIQUE,
    FOREIGN_KEY,
    REQUEST_ID,
    APPLY_DELTA
}

struct CoordRequestMessage
{
    1: required i32 messageId;
    2: required list<RequestEntry> requests;
}

struct CoordResponseMessage
{
    1: required i32 messageId;
    2: required bool success;
    3: list<ResponseEntry> responses;  // fill only with auto increment assignments
    4: string errorMessage;
}

struct ResponseEntry {
    1: required string id; // the pk value that identifies this tuple
    2: required bool success;
    3: string resquestedValue;
}

struct RequestEntry {
    1: required RequestType type;
    2: required string id; // the pk value that identifies this tuple
    3: required string constraintId;
    4: string value;
}

struct ThriftOperation {
 1: required i32 txnId;
 2: required list<string> operations;
}

service ReplicatorRPC {
 bool commitOperation(1:ThriftOperation op);
 bool commitOperationSync(1:ThriftOperation op);
 oneway void commitOperationAsync(1:ThriftOperation op);
}

service CoordinatorRPC
{

    CoordResponseMessage checkInvariants(1:CoordRequestMessage checkRequest);
}