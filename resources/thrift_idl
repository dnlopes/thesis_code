namespace java util.thrift

struct ApplyDelta
{
    1: required string constraintId;
    2: required string deltaValue;
    3: required string rowId;
}
struct RequestValue
{
    1: required string constraintId;
    2: required i32 opId;
    3: required string fieldName;
    4: string requestedValue;
}

struct UniqueValue
{
    1: required string constraintId;
    2: required string value;
}

struct CoordinatorResponse
{
    1: required bool success;
    2: list<RequestValue> requestedValues;
    3: string errorMessage;
}

struct CoordinatorRequest
{
    1: required i32 requestId;
    2: list<RequestValue> requests;
    3: list<UniqueValue> uniqueValues;
    4: list<ApplyDelta> deltaValues;

}

struct ThriftOperation {
 1: required i32 txnId;
 2: required list<string> operations;
 3: string clock
 4: required i32 replicatorId;
}

service ReplicatorRPC {
 bool commitOperation(1:ThriftOperation op);
 oneway void commitOperationAsync(1:ThriftOperation op);
}


service CoordinatorRPC
{
    CoordinatorResponse checkInvariants(1:CoordinatorRequest req);
}