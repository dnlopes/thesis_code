<project name="TPCW" default="compile" basedir=".">

    <!-- EDIT THE FOLLOWING TWO PARAMETERS ACCORDING TO YOUR SYSTEM -->
    <property environment="env"/>

    <property name="mysql.host" value="localhost"/>
    <property name="mysql.port" value="53306"/>

    <!-- TPCW OPTIONS -->
    <property name="TPCW_NUM_EBS" value="50"/>
    <property name="TPCW_NUM_ITEMS" value="100"/>
    <property name="gendb-tpcw" value="applications.TPCW_Populate" />


    <!-- set properties for this build -->
    <property name="base.dir" value="."/>
    <property name="src.dir" value="${base.dir}/src"/>
    <property name="dist.dir" value="${base.dir}/dist"/>
    <property name="libs.dir" value="${base.dir}/libs"/>
    <property name="classes.dir" value="${dist.dir}/classes"/>


    <!-- PATHS DEFINITIONS -->
    <path id="dependencies.path">
        <fileset dir="${libs.dir}">
            <include name="*.jar"/>
        </fileset>
    </path>
    <path id="runtime.path">
        <pathelement path="${classes.dir}"/>
    </path>

    <!-- MAIN TASKS -->

    <target name="init" depends="clean">
        <tstamp/>
        <mkdir dir="${dist.dir}"/>
        <mkdir dir="${classes.dir}"/>
    </target>

    <target name="clean" description="Clean distribution directory">
        <delete dir="${dist.dir}"/>
    </target>

    <target name="compile" depends="init" description="Compile source code">
        <javac srcdir="${src.dir}/" destdir="${classes.dir}" source="1.7" target="1.7" includeantruntime="false">
            <classpath refid="dependencies.path"/>
        </javac>
    </target>

    <target name="tpcw-gendb" depends="start-mysql,compile" description="Generate TPCW database">
        <java classname="${gendb-tpcw}" fork="true" >
            <arg value="${TPCW_NUM_EBS}"/>
            <arg value="${TPCW_NUM_ITEMS}"/>
            <classpath refid="runtime.path"/>
            <classpath refid="dependencies.path"/>
        </java>
    </target>

    <target name="start-mysql" unless="mysql.running" depends="test-mysql">
        <exec failonerror="true" executable="/bin/bash" osfamily="unix" dir="${base.dir}/scripts">
            <arg value="start-mysql.sh"/>
        </exec>
    </target>
    <target name="stop-mysql" if="mysql.running" depends="test-mysql">
        <exec failonerror="true" executable="/bin/bash" osfamily="unix" dir="${base.dir}/scripts">
            <arg value="stop-mysql.sh"/>
        </exec>
    </target>
    <target name="test-mysql">
        <condition property="mysql.running">
            <socket server="${mysql.host}" port="${mysql.port}"/>
        </condition>
    </target>
    <target name="check-mysql">
        <echo message="Checking whether MySQL is running..."/>
        <fail message="MySQL is not running. :(">
            <condition>
                <not>
                    <socket server="${mysql.host}" port="${mysql.port}"/>
                </not>
            </condition>
        </fail>
        <echo message="MySQL is running :D"/>
    </target>
</project>

